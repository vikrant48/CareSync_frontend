<app-doctor-layout>
  <div class="relative min-h-[600px]">
    <!-- Profile Content -->
    <section class="max-w-5xl mx-auto space-y-6 pb-20" *ngIf="!loading() && !error()">
      <!-- ... (rest of the header, tabs, and content) ... -->

      <!-- Premium Profile Header -->
      <div
        class="bg-white dark:bg-gray-900 rounded-[2rem] shadow-xl overflow-hidden border border-gray-100 dark:border-gray-800">
        <!-- Cover Area -->
        <div class="profile-cover">
          <div class="absolute inset-0 bg-white/10 backdrop-blur-[2px] opacity-20 pattern-dots"></div>
        </div>

        <!-- Profile Info Bar -->
        <div class="px-6 pb-8 md:px-10 md:pb-10 flex flex-col md:flex-row items-center md:items-end gap-6">
          <!-- Avatar Wrapper with On-Image Upload -->
          <div class="profile-avatar-container">
            <div class="avatar-wrapper group ring-4 ring-white dark:ring-gray-900 shadow-2xl"
              (click)="triggerProfileImageUpload()" title="Click to change profile picture">

              <!-- Real-time Preview Overlay -->
              <div *ngIf="profileImagePreviewUrl"
                class="absolute inset-0 z-30 bg-black/60 backdrop-blur-sm flex flex-col items-center justify-center p-2 text-center animate-in fade-in zoom-in duration-200">
                <img [src]="profileImagePreviewUrl" class="absolute inset-0 w-full h-full object-cover opacity-40" />
                <div class="relative z-10 space-y-2">
                  <p class="text-[10px] font-bold text-white uppercase tracking-widest">New Image</p>
                  <div class="flex gap-2">
                    <button (click)="$event.stopPropagation(); uploadSelectedProfileImage()"
                      class="w-8 h-8 rounded-full bg-green-500 text-white flex items-center justify-center shadow-lg hover:scale-110 transition-transform">
                      <i class="fa-solid fa-check text-xs"></i>
                    </button>
                    <button (click)="$event.stopPropagation(); clearProfileImageSelection()"
                      class="w-8 h-8 rounded-full bg-red-500 text-white flex items-center justify-center shadow-lg hover:scale-110 transition-transform">
                      <i class="fa-solid fa-xmark text-xs"></i>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Existing/Preview Image -->
              <img *ngIf="profile?.profileImageUrl || profileImagePreviewUrl; else initials"
                [src]="profileImagePreviewUrl || profile?.profileImageUrl"
                class="w-full h-full object-cover transition-opacity duration-300"
                [class.opacity-50]="uploadingProfileImage" />

              <ng-template #initials>
                <div
                  class="w-full h-full flex items-center justify-center bg-blue-100 dark:bg-gray-800 text-blue-600 dark:text-blue-400 text-4xl font-black">
                  {{ (profile?.firstName || profile?.username || 'D').charAt(0) }}
                </div>
              </ng-template>

              <!-- Loading Spinner -->
              <div *ngIf="uploadingProfileImage"
                class="absolute inset-0 z-40 bg-black/40 flex items-center justify-center">
                <i class="fa-solid fa-spinner animate-spin text-white text-2xl"></i>
              </div>

              <!-- Hover Overlay -->
              <div class="avatar-overlay">
                <i class="fa-solid fa-camera"></i>
              </div>
            </div>

            <!-- Hidden Input -->
            <input type="file" #profileImageInput (change)="onProfileImageSelected($event)" accept="image/*"
              class="hidden">

            <!-- Camera Action Button (Mobile) -->
            <button (click)="triggerProfileImageUpload()" class="on-image-btn md:hidden">
              <i class="fa-solid fa-camera text-xs"></i>
            </button>
          </div>

          <!-- Doctor Identity -->
          <div class="flex-1 text-center md:text-left space-y-2">
            <div class="flex flex-col md:flex-row items-center gap-2 md:gap-3">
              <h1 class="text-2xl md:text-4xl font-black tracking-tight text-gray-900 dark:text-white">
                {{ displayName() }}
              </h1>
              <div *ngIf="profile?.isVerified" class="text-blue-500 text-xl md:text-2xl">
                <i class="fa-solid fa-circle-check"></i>
              </div>
            </div>

            <div class="flex flex-wrap items-center justify-center md:justify-start gap-4 text-sm font-medium">
              <div
                class="flex items-center gap-1.5 text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 px-3 py-1 rounded-full">
                <i class="fa-solid fa-stethoscope"></i>
                {{ profile?.specialization || 'General Physician' }}
              </div>
              <div class="flex items-center gap-1.5 text-gray-500 dark:text-gray-400">
                <i class="fa-solid fa-id-badge text-gray-400"></i>
                ID: #{{ profile?.id ?? '—' }}
              </div>
            </div>
          </div>

          <!-- Quick Stats -->
          <div class="flex gap-2 md:gap-3 w-full md:w-auto">
            <div class="stat-item flex-1 shrink-0">
              <span class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1">Status</span>
              <div class="flex items-center gap-1.5 justify-center">
                <span [class]="profile?.isActive ? 'bg-green-500' : 'bg-red-500'"
                  class="w-2 h-2 rounded-full animate-pulse"></span>
                <span class="text-sm font-bold">{{ profile?.isActive ? 'Active' : 'Away' }}</span>
              </div>
            </div>
            <div class="stat-item flex-1 shrink-0">
              <span class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1">Fees</span>
              <span class="text-sm font-bold text-blue-600 dark:text-blue-400">₹{{ profile?.consultationFees ?? 0
                }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Navigation Tabs -->
      <div class="tab-pills px-2">
        <button class="tab-pill" [class.active]="activeTab==='overview'" (click)="activeTab='overview'">
          <i class="fa-solid fa-user-doctor mr-1.5"></i> Overview
        </button>
        <button class="tab-pill" [class.active]="activeTab==='education'" (click)="activeTab='education'">
          <i class="fa-solid fa-graduation-cap mr-1.5"></i> Education
        </button>
        <button class="tab-pill" [class.active]="activeTab==='experience'" (click)="activeTab='experience'">
          <i class="fa-solid fa-briefcase mr-1.5"></i> Experience
        </button>
        <button class="tab-pill" [class.active]="activeTab==='certificates'" (click)="activeTab='certificates'">
          <i class="fa-solid fa-certificate mr-1.5"></i> Certificates
        </button>
      </div>

      <!-- Tab Content Area -->
      <div class="space-y-6">

        <!-- Overview Tab -->
        <div *ngIf="activeTab==='overview'" class="animate-in fade-in slide-in-from-bottom-2 duration-300">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-black text-gray-900 dark:text-white">General Overview</h2>
            <button class="btn-secondary !py-2 !px-4 text-sm" *ngIf="!editingOverview" (click)="startEditOverview()">
              <i class="fa-solid fa-pen-to-square"></i> Edit Profile
            </button>
          </div>

          <!-- View Mode: Overview Cards -->
          <div *ngIf="!editingOverview" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div
              class="bg-white dark:bg-gray-800 p-6 rounded-3xl border border-gray-100 dark:border-gray-800 shadow-sm space-y-4">
              <h3 class="font-bold text-gray-400 uppercase tracking-widest text-[10px] flex items-center gap-2">
                <i class="fa-solid fa-user"></i> Personal Details
              </h3>
              <div class="space-y-3">
                <div class="flex justify-between border-b border-gray-50 dark:border-gray-700/50 pb-2">
                  <span class="text-sm text-gray-500">First Name</span>
                  <span class="text-sm font-bold">{{ profile?.firstName || '—' }}</span>
                </div>
                <div class="flex justify-between border-b border-gray-50 dark:border-gray-700/50 pb-2">
                  <span class="text-sm text-gray-500">Last Name</span>
                  <span class="text-sm font-bold">{{ profile?.lastName || '—' }}</span>
                </div>
                <div class="flex justify-between border-b border-gray-50 dark:border-gray-700/50 pb-2">
                  <span class="text-sm text-gray-500">Gender</span>
                  <span class="text-sm font-bold">{{ profile?.gender || '—' }}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-sm text-gray-500">Languages</span>
                  <div class="flex flex-wrap gap-1 justify-end">
                    <span *ngFor="let lang of profileForm.languages"
                      class="text-[10px] font-bold bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 px-2 py-0.5 rounded-md">
                      {{ lang }}
                    </span>
                    <span *ngIf="!profileForm.languages?.length" class="text-sm font-bold">None</span>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="bg-white dark:bg-gray-800 p-6 rounded-3xl border border-gray-100 dark:border-gray-800 shadow-sm space-y-4">
              <h3 class="font-bold text-gray-400 uppercase tracking-widest text-[10px] flex items-center gap-2">
                <i class="fa-solid fa-address-book"></i> Contact & Fees
              </h3>
              <div class="space-y-3">
                <div class="flex justify-between border-b border-gray-50 dark:border-gray-700/50 pb-2">
                  <span class="text-sm text-gray-500">Email Address</span>
                  <span class="text-sm font-bold">{{ profile?.email || '—' }}</span>
                </div>
                <div class="flex justify-between border-b border-gray-50 dark:border-gray-700/50 pb-2">
                  <span class="text-sm text-gray-500">Contact Number</span>
                  <span class="text-sm font-bold">{{ profile?.contactInfo || '—' }}</span>
                </div>
                <div class="flex justify-between border-b border-gray-50 dark:border-gray-700/50 pb-2">
                  <span class="text-sm text-gray-500">Consultation Fees</span>
                  <span class="text-sm font-bold text-blue-600">₹{{ profile?.consultationFees ?? '0' }}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-sm text-gray-500">Location</span>
                  <span class="text-sm font-bold text-right max-w-[150px] truncate" [title]="profile?.address">{{
                    profile?.address || '—' }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Edit Mode: Overview Form -->
          <div *ngIf="editingOverview"
            class="bg-white dark:bg-gray-800 p-6 md:p-10 rounded-[2.5rem] border border-gray-100 dark:border-gray-800 shadow-xl space-y-8 animate-in zoom-in-95 duration-200">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="space-y-5">
                <h4
                  class="font-black text-gray-900 dark:text-white uppercase tracking-wider text-xs border-l-4 border-blue-500 pl-3">
                  Basic Information</h4>
                <div class="grid grid-cols-2 gap-4">
                  <div class="space-y-1.5">
                    <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">First
                      Name</label>
                    <input class="input-modern" [(ngModel)]="profileForm.firstName" placeholder="John" />
                  </div>
                  <div class="space-y-1.5">
                    <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Last Name</label>
                    <input class="input-modern" [(ngModel)]="profileForm.lastName" placeholder="Doe" />
                  </div>
                </div>
                <div class="space-y-1.5">
                  <label
                    class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Specialization</label>
                  <app-specialization-autocomplete [(ngModel)]="profileForm.specialization"
                    placeholder="e.g. Cardiologist" inputClass="input-modern"></app-specialization-autocomplete>
                </div>
                <div class="grid grid-cols-2 gap-4">
                  <div class="space-y-1.5">
                    <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Gender</label>
                    <select class="input-modern" [(ngModel)]="profileForm.gender">
                      <option [ngValue]="undefined">Select</option>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                      <option value="Other">Other</option>
                    </select>
                  </div>
                  <div class="space-y-1.5">
                    <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Fees (₹)</label>
                    <input type="number" class="input-modern" [(ngModel)]="profileForm.consultationFees" />
                  </div>
                </div>
              </div>

              <div class="space-y-5">
                <h4
                  class="font-black text-gray-900 dark:text-white uppercase tracking-wider text-xs border-l-4 border-indigo-500 pl-3">
                  Contact & Languages</h4>
                <div class="space-y-1.5">
                  <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Email
                    Address</label>
                  <input type="email" class="input-modern" [(ngModel)]="profileForm.email" />
                </div>
                <div class="space-y-1.5">
                  <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Contact
                    Number</label>
                  <input class="input-modern" [(ngModel)]="profileForm.contactInfo" />
                </div>
                <div class="space-y-1.5">
                  <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Clinic
                    Address</label>
                  <input class="input-modern" [(ngModel)]="profileForm.address" />
                </div>
                <div class="space-y-2">
                  <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Languages
                    Spoken</label>
                  <div class="flex flex-wrap gap-2">
                    <label *ngFor="let lang of languageOptions"
                      class="inline-flex items-center gap-2 bg-gray-50 dark:bg-gray-900 px-3 py-2 rounded-xl border border-gray-100 dark:border-gray-800 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                      <input type="checkbox" [checked]="profileForm.languages?.includes(lang)"
                        (change)="toggleLanguage(lang, $event)" class="rounded text-blue-600 focus:ring-blue-500" />
                      <span class="text-sm font-bold text-gray-700 dark:text-gray-300">{{ lang }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div class="flex items-center gap-3 pt-4 border-t border-gray-50 dark:border-gray-800">
              <button class="btn-primary flex-1 md:flex-none md:min-w-[150px]" (click)="saveProfile()">
                <i class="fa-solid fa-floppy-disk"></i> Save Profile
              </button>
              <button class="btn-secondary flex-1 md:flex-none" (click)="editingOverview=false">Cancel</button>
            </div>
          </div>
        </div>

        <!-- Education Tab -->
        <div *ngIf="activeTab==='education'" class="animate-in fade-in slide-in-from-bottom-2 duration-300 space-y-6">
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-black text-gray-900 dark:text-white">Education & Credentials</h2>
            <button class="btn-primary !py-2 !px-4 text-sm" *ngIf="!editingEducationMode" (click)="startAddEducation()">
              <i class="fa-solid fa-plus"></i> Add New
            </button>
          </div>

          <!-- Add/Edit form for Education -->
          <div *ngIf="editingEducationMode"
            class="bg-gray-50 dark:bg-gray-900/50 p-6 rounded-3xl border border-gray-100 dark:border-gray-800 space-y-6 animate-in zoom-in-95 duration-200">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
              <div class="space-y-1.5">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Degree /
                  Qualification</label>
                <select class="input-modern" [(ngModel)]="newEducation.degree">
                  <option [ngValue]="''">Select degree</option>
                  <option *ngFor="let d of degreeOptions" [value]="d">{{ d }}</option>
                  <option value="__other__">Add new degree…</option>
                </select>
                <div *ngIf="newEducation.degree==='__other__'" class="mt-2 flex items-center gap-2">
                  <input class="input flex-1" [(ngModel)]="customDegree" placeholder="Enter degree" />
                  <button class="btn-secondary !p-3" (click)="addCustomDegree()"><i
                      class="fa-solid fa-check"></i></button>
                </div>
              </div>
              <div class="space-y-1.5">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Institution /
                  University</label>
                <select class="input-modern" [(ngModel)]="newEducation.institution">
                  <option [ngValue]="''">Select institution</option>
                  <option *ngFor="let i of institutionOptions" [value]="i">{{ i }}</option>
                  <option value="__other__">Add new institution…</option>
                </select>
                <div *ngIf="newEducation.institution==='__other__'" class="mt-2 flex items-center gap-2">
                  <input class="input flex-1" [(ngModel)]="customInstitution" placeholder="Enter institution" />
                  <button class="btn-secondary !p-3" (click)="addCustomInstitution()"><i
                      class="fa-solid fa-check"></i></button>
                </div>
              </div>
              <div class="space-y-1.5">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Year of
                  Completion</label>
                <input type="number" class="input-modern" [(ngModel)]="newEducation.yearOfCompletion" />
              </div>
              <div class="space-y-1.5">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Additional
                  Details</label>
                <input class="input-modern" [(ngModel)]="newEducation.details"
                  placeholder="e.g. Gold Medalist, Specialization details" />
              </div>
            </div>
            <div class="flex items-center gap-3 pt-4 border-t border-gray-100 dark:border-gray-800">
              <button class="btn-primary flex-1 md:flex-none md:min-w-[200px]" (click)="submitEducation()">
                {{ editingEducationId ? 'Update Education' : 'Add Education' }}
              </button>
              <button class="btn-secondary flex-1 md:flex-none" (click)="cancelEditEducation()">Cancel</button>
            </div>
          </div>

          <!-- Education List Cards -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4" *ngIf="!editingEducationMode">
            <div *ngFor="let e of educations; index as i"
              class="list-card group animate-in slide-in-from-bottom-3 duration-300"
              [style.animation-delay]="i*50 + 'ms'">
              <div class="flex justify-between items-start">
                <div class="flex items-center gap-3">
                  <div
                    class="w-12 h-12 rounded-2xl bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center text-xl shadow-sm">
                    <i class="fa-solid fa-graduation-cap"></i>
                  </div>
                  <div>
                    <h4 class="font-black text-gray-900 dark:text-white leading-tight">{{ e.degree }}</h4>
                    <p class="text-xs font-bold text-gray-400 uppercase tracking-wide">{{ e.yearOfCompletion }}</p>
                  </div>
                </div>
                <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                  <button (click)="startEditEducation(e)"
                    class="w-8 h-8 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-500 hover:text-blue-600 dark:hover:text-blue-400 flex items-center justify-center transition-colors">
                    <i class="fa-solid fa-pen text-xs"></i>
                  </button>
                  <button (click)="deleteEducation(e)"
                    class="w-8 h-8 rounded-lg bg-red-50 dark:bg-red-900/20 text-red-500 flex items-center justify-center transition-colors">
                    <i class="fa-solid fa-trash-can text-xs"></i>
                  </button>
                </div>
              </div>
              <div class="space-y-2 pt-2">
                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300">
                  <i class="fa-solid fa-building-columns text-gray-400 w-4"></i>
                  {{ e.institution }}
                </div>
                <div *ngIf="e.details"
                  class="text-xs text-gray-500 dark:text-gray-400 italic bg-gray-50 dark:bg-gray-900/40 p-2 rounded-xl border border-gray-100 dark:border-gray-800">
                  "{{ e.details }}"
                </div>
              </div>
            </div>
            <div *ngIf="educations.length === 0"
              class="md:col-span-2 text-center py-12 bg-gray-50 dark:bg-gray-900/30 rounded-[2rem] border border-dashed border-gray-200 dark:border-gray-800">
              <i class="fa-solid fa-book-open text-3xl text-gray-200 mb-3"></i>
              <p class="text-gray-400 font-bold uppercase tracking-widest text-[10px]">No education details listed</p>
            </div>
          </div>
        </div>

        <!-- Experience Tab -->
        <div *ngIf="activeTab==='experience'" class="animate-in fade-in slide-in-from-bottom-2 duration-300 space-y-6">
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-black text-gray-900 dark:text-white">Professional Experience</h2>
            <button class="btn-primary !py-2 !px-4 text-sm" *ngIf="!editingExperienceMode"
              (click)="startAddExperience()">
              <i class="fa-solid fa-plus"></i> Add New
            </button>
          </div>

          <!-- Add/Edit form for Experience -->
          <div *ngIf="editingExperienceMode"
            class="bg-indigo-50/30 dark:bg-indigo-900/10 p-6 rounded-3xl border border-indigo-100/50 dark:border-indigo-800/20 space-y-6 animate-in zoom-in-95 duration-200">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
              <div class="space-y-1.5">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Hospital / Clinic
                  Name</label>
                <select class="input-modern" [(ngModel)]="newExperience.hospitalName">
                  <option [ngValue]="''">Select hospital</option>
                  <option *ngFor="let h of hospitalOptions" [value]="h">{{ h }}</option>
                  <option value="__other__">Add new hospital…</option>
                </select>
                <div *ngIf="newExperience.hospitalName==='__other__'" class="mt-2 flex items-center gap-2">
                  <input class="input flex-1" [(ngModel)]="customHospital" placeholder="Enter hospital" />
                  <button class="btn-secondary !p-3" (click)="addCustomHospital()"><i
                      class="fa-solid fa-check"></i></button>
                </div>
              </div>
              <div class="space-y-1.5">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Designation /
                  Role</label>
                <select class="input-modern" [(ngModel)]="newExperience.position">
                  <option [ngValue]="''">Select position</option>
                  <option *ngFor="let p of positionOptions" [value]="p">{{ p }}</option>
                  <option value="__other__">Add new position…</option>
                </select>
                <div *ngIf="newExperience.position==='__other__'" class="mt-2 flex items-center gap-2">
                  <input class="input flex-1" [(ngModel)]="customPosition" placeholder="Enter position" />
                  <button class="btn-secondary !p-3" (click)="addCustomPosition()"><i
                      class="fa-solid fa-check"></i></button>
                </div>
              </div>
              <div class="space-y-1.5">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Years of
                  Service</label>
                <input type="number" class="input-modern" [(ngModel)]="newExperience.yearsOfService" />
              </div>
              <div class="space-y-1.5">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Role
                  Description</label>
                <input class="input-modern" [(ngModel)]="newExperience.details"
                  placeholder="e.g. Senior Consultant in Ophthalmology" />
              </div>
            </div>
            <div class="flex items-center gap-3 pt-4 border-t border-indigo-100 dark:border-indigo-900/30">
              <button class="btn-primary flex-1 md:flex-none md:min-w-[200px]" (click)="submitExperience()">
                {{ editingExperienceId ? 'Update Experience' : 'Add Experience' }}
              </button>
              <button class="btn-secondary flex-1 md:flex-none" (click)="cancelEditExperience()">Cancel</button>
            </div>
          </div>

          <!-- Experience List Cards -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4" *ngIf="!editingExperienceMode">
            <div *ngFor="let x of experiences; index as i"
              class="list-card group animate-in slide-in-from-bottom-3 duration-300"
              [style.animation-delay]="i*50 + 'ms'">
              <div class="flex justify-between items-start">
                <div class="flex items-center gap-3">
                  <div
                    class="w-12 h-12 rounded-2xl bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 flex items-center justify-center text-xl shadow-sm">
                    <i class="fa-solid fa-hospital-user"></i>
                  </div>
                  <div>
                    <h4 class="font-black text-gray-900 dark:text-white leading-tight">{{ x.position }}</h4>
                    <p class="text-[10px] font-black text-indigo-500 uppercase tracking-widest">{{ x.yearsOfService }}
                      Years
                      Experience</p>
                  </div>
                </div>
                <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                  <button (click)="startEditExperience(x)"
                    class="w-8 h-8 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-500 hover:text-indigo-600 dark:hover:text-indigo-400 flex items-center justify-center transition-colors">
                    <i class="fa-solid fa-pen text-xs"></i>
                  </button>
                  <button (click)="deleteExperience(x)"
                    class="w-8 h-8 rounded-lg bg-red-50 dark:bg-red-900/20 text-red-500 flex items-center justify-center transition-colors">
                    <i class="fa-solid fa-trash-can text-xs"></i>
                  </button>
                </div>
              </div>
              <div class="space-y-2 pt-2">
                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300">
                  <i class="fa-solid fa-hospital text-gray-400 w-4"></i>
                  {{ x.hospitalName }}
                </div>
                <p *ngIf="x.details" class="text-xs text-gray-500 dark:text-gray-400 leading-relaxed font-medium">
                  {{ x.details }}
                </p>
              </div>
            </div>
            <div *ngIf="experiences.length === 0"
              class="md:col-span-2 text-center py-12 bg-gray-50 dark:bg-gray-900/30 rounded-[2rem] border border-dashed border-gray-200 dark:border-gray-800">
              <i class="fa-solid fa-user-md text-3xl text-gray-200 mb-3"></i>
              <p class="text-gray-400 font-bold uppercase tracking-widest text-[10px]">No professional experience listed
              </p>
            </div>
          </div>
        </div>

        <!-- Certificates Tab -->
        <div *ngIf="activeTab==='certificates'"
          class="animate-in fade-in slide-in-from-bottom-2 duration-300 space-y-6">
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-black text-gray-900 dark:text-white">Medical Certificates</h2>
            <button class="btn-primary !py-2 !px-4 text-sm" *ngIf="!editingCertificatesMode"
              (click)="startAddCertificate()">
              <i class="fa-solid fa-upload"></i> Upload Certificate
            </button>
          </div>

          <!-- Add Certificate Flow -->
          <div *ngIf="editingCertificatesMode"
            class="bg-gray-50 dark:bg-gray-900/50 p-6 rounded-3xl border border-gray-100 dark:border-gray-800 space-y-5 animate-in zoom-in-95 duration-200">
            <div class="flex flex-col md:flex-row items-center gap-4">
              <div class="w-full flex-1">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Select File (PDF,
                  Image)</label>
                <div class="mt-1 relative group">
                  <input type="file" #certFileInput (change)="onCertFileSelected($event)"
                    accept="application/pdf,image/*"
                    class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />
                  <div
                    class="input flex items-center gap-3 border-dashed group-hover:border-blue-500 transition-colors">
                    <i class="fa-solid fa-file-arrow-up text-gray-400 group-hover:text-blue-500"></i>
                    <span class="text-sm overflow-hidden text-ellipsis whitespace-nowrap">{{ certFile?.name || 'Choose
                      file
                      or drag & drop' }}</span>
                  </div>
                </div>
              </div>
              <div class="w-full flex-1">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Certificate
                  Description</label>
                <input class="input mt-1" placeholder="e.g. Fellowship in Cardiology" [(ngModel)]="certDescription" />
              </div>
            </div>
            <div class="flex items-center gap-3 pt-2">
              <button class="btn-primary flex-1 md:flex-none md:min-w-[180px]" (click)="uploadCertificate()"
                [disabled]="uploadingCertificate || !certFile">
                <i class="fa-solid fa-circle-notch animate-spin" *ngIf="uploadingCertificate"></i>
                {{ uploadingCertificate ? 'Uploading…' : 'Start Upload' }}
              </button>
              <button class="btn-modern-secondary" (click)="cancelAddCertificate()">Cancel</button>
            </div>
          </div>

          <!-- Certificate List Group -->
          <div class="space-y-4" *ngIf="!editingCertificatesMode && !editingCertId">
            <div *ngFor="let c of certificates; index as i"
              class="bg-white dark:bg-gray-800 p-4 md:p-5 rounded-2xl md:rounded-[2rem] border border-gray-100 dark:border-gray-800 shadow-sm flex flex-col md:flex-row items-center justify-between gap-4 group hover:shadow-lg transition-all border-l-4 hover:border-l-blue-500 animate-in slide-in-from-right-3 duration-300"
              [style.animation-delay]="i*50 + 'ms'">
              <div class="flex items-center gap-4 w-full md:w-auto">
                <div
                  class="w-14 h-14 rounded-2xl bg-orange-50 dark:bg-orange-900/20 text-orange-500 flex items-center justify-center text-2xl shrink-0">
                  <i class="fa-solid fa-file-contract"></i>
                </div>
                <div class="flex-1 min-w-0">
                  <h4 class="font-black text-gray-900 dark:text-white truncate" [title]="c.name">
                    {{ c.name || c.originalFilename || 'Medical Certificate' }}
                  </h4>
                  <div class="flex flex-wrap gap-2 mt-1">
                    <a *ngIf="c.url" [href]="c.url" target="_blank"
                      class="text-[10px] font-black text-blue-500 hover:text-blue-600 bg-blue-50 dark:bg-blue-900/30 px-2 py-0.5 rounded uppercase tracking-wider transition-colors">
                      <i class="fa-solid fa-eye mr-1"></i> View Document
                    </a>
                    <a *ngIf="c.credentialUrl" [href]="c.credentialUrl" target="_blank"
                      class="text-[10px] font-black text-emerald-500 hover:text-emerald-600 bg-emerald-50 dark:bg-emerald-900/30 px-2 py-0.5 rounded uppercase tracking-wider transition-colors">
                      <i class="fa-solid fa-shield-check mr-1"></i> Verify
                    </a>
                  </div>
                </div>
              </div>
              <div
                class="flex items-center gap-2 w-full md:w-auto justify-end border-t md:border-t-0 md:pt-0 pt-3 md:mt-0 mt-2 border-gray-50 dark:border-gray-800">
                <button (click)="startEditCert(c)" class="btn-secondary !py-2 !px-3 !text-[11px] !rounded-lg shrink-0">
                  <i class="fa-solid fa-pen"></i> Details
                </button>
                <label class="btn-secondary !py-2 !px-3 !text-[11px] !rounded-lg cursor-pointer shrink-0">
                  <i class="fa-solid fa-rotate"></i> Replace
                  <input type="file" class="hidden" (change)="replaceCertificateFile(c, $event)"
                    accept="application/pdf,image/*" />
                </label>
                <button (click)="deleteCertificate(c)"
                  class="w-9 h-9 flex items-center justify-center text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors shrink-0">
                  <i class="fa-solid fa-trash-can"></i>
                </button>
              </div>
            </div>

            <div *ngIf="certificates.length === 0"
              class="text-center py-12 bg-gray-50 dark:bg-gray-900/30 rounded-[2rem] border border-dashed border-gray-200 dark:border-gray-800">
              <i class="fa-solid fa-award text-3xl text-gray-200 mb-3"></i>
              <p class="text-gray-400 font-bold uppercase tracking-widest text-[10px]">No medical certificates uploaded
              </p>
            </div>
          </div>

          <!-- Edit Certificate Meta Form -->
          <div *ngIf="editingCertId as eid"
            class="bg-white dark:bg-gray-800 p-6 md:p-10 rounded-[2.5rem] border border-gray-100 dark:border-gray-800 shadow-xl space-y-6 animate-in zoom-in-95 duration-200">
            <h3 class="text-lg font-black text-gray-900 dark:text-white flex items-center gap-3">
              <i class="fa-solid fa-pen-nib text-blue-500"></i> Edit Certificate Metadata
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5" *ngIf="findCert(eid) as cert">
              <div class="space-y-1.5">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Certificate
                  Name</label>
                <input class="input-modern" [(ngModel)]="certEdit[eid].name" placeholder="Name" />
              </div>
              <div class="space-y-1.5">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Issuing
                  Organization</label>
                <input class="input-modern" [(ngModel)]="certEdit[eid].issuingOrganization" placeholder="Institution" />
              </div>
              <div class="space-y-1.5">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Issue Date</label>
                <input class="input-modern" type="date" [(ngModel)]="certEdit[eid].issueDate" />
              </div>
              <div class="space-y-1.5">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Expiry Date</label>
                <input class="input-modern" type="date" [(ngModel)]="certEdit[eid].expiryDate" />
              </div>
              <div class="space-y-1.5">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Credential ID
                  (Optional)</label>
                <input class="input-modern" [(ngModel)]="certEdit[eid].credentialId" placeholder="ID" />
              </div>
              <div class="space-y-1.5">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Verification URL
                  (Optional)</label>
                <input class="input-modern" [(ngModel)]="certEdit[eid].credentialUrl" placeholder="https://..." />
              </div>
              <div class="space-y-1.5 md:col-span-2">
                <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Additional
                  Details</label>
                <textarea class="input min-h-[100px]" [(ngModel)]="certEdit[eid].details"
                  placeholder="Describe this certification..."></textarea>
              </div>
            </div>
            <div class="flex items-center gap-3 pt-4 border-t border-gray-100 dark:border-gray-800">
              <button class="btn-primary flex-1 md:flex-none md:min-w-[150px]"
                (click)="saveCertificateMeta(findCert(eid))">
                <i class="fa-solid fa-check"></i> Save Details
              </button>
              <button class="btn-secondary !px-8" (click)="cancelEditCert()">Cancel</button>
            </div>
          </div>
        </div>
      </div>

    </section>

    <!-- Loading & States -->
    <div *ngIf="loading()"
      class="absolute inset-0 z-50 bg-white/60 dark:bg-gray-950/60 backdrop-blur-md flex flex-col items-center justify-center rounded-[2rem]">
      <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"></div>
      <p class="text-gray-500 font-bold uppercase tracking-widest text-xs">Accessing Medical Profile...</p>
    </div>

    <div *ngIf="error()"
      class="absolute inset-0 z-50 bg-white dark:bg-gray-950 flex flex-col items-center justify-center p-10 text-center animate-in fade-in duration-300 rounded-[2rem]">
      <div
        class="w-20 h-20 bg-red-50 dark:bg-red-900/20 text-red-500 rounded-full flex items-center justify-center mx-auto mb-6 text-3xl">
        <i class="fa-solid fa-circle-exclamation"></i>
      </div>
      <h3 class="text-xl font-black text-gray-900 dark:text-white mb-2">Something went wrong</h3>
      <p class="text-gray-500 dark:text-gray-400 mb-6">{{ error() }}</p>
      <button class="btn-primary mx-auto" (click)="loadAll()">
        <i class="fa-solid fa-rotate"></i> Try Again
      </button>
    </div>
  </div>
</app-doctor-layout>